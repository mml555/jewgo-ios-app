# React Native 0.76.x iOS Build Issues

## ‚ö†Ô∏è CURRENT STATUS

**React Native Version:** 0.76.9  
**iOS Build Status:** ‚ùå **PROBLEMATIC** - Persistent Yoga header issues  
**Recommendation:** Consider downgrading to 0.75.x or waiting for 0.77.x

---

## The Core Problem

React Native 0.76.x introduced a breaking change in the Yoga layout engine directory structure that makes iOS builds extremely difficult:

### What Changed

**0.75.x and earlier:**
```
ReactCommon/yoga/
  ‚îú‚îÄ‚îÄ Yoga.h
  ‚îú‚îÄ‚îÄ YGNode.h
  ‚îî‚îÄ‚îÄ (flat structure)
```

**0.76.x:**
```
ReactCommon/yoga/yoga/
  ‚îú‚îÄ‚îÄ Yoga.h
  ‚îú‚îÄ‚îÄ numeric/Comparison.h
  ‚îú‚îÄ‚îÄ algorithm/Cache.h
  ‚îú‚îÄ‚îÄ debug/AssertFatal.h
  ‚îî‚îÄ‚îÄ (nested structure)
```

### The Issue

Yoga C++ files use includes like:
```cpp
#include <yoga/numeric/Comparison.h>
```

But when CocoaPods compiles the Yoga pod:
- Source root is set to: `ios/Pods/Yoga/yoga`
- Include path resolves to: `ios/Pods/Yoga/yoga/yoga/numeric/Comparison.h` ‚ùå
- Actual file location: `ios/Pods/Yoga/yoga/numeric/Comparison.h` ‚úÖ

The path mismatch causes "file not found" errors.

---

## Attempted Fixes

We've tried multiple approaches:

### ‚úÖ 1. **Symbolic Links** (Partial Success)
Created symlinks in `ios/Pods/Headers/Public/Yoga/` for subdirectories.
- **Result:** Helps with some paths but doesn't fully resolve the issue

### ‚úÖ 2. **Podfile Modifications** (Partial Success)
Added header search paths in `post_install` hook.
- **Result:** Paths are added but not always picked up by compiler

### ‚úÖ 3. **Yoga.podspec Patch** (Limited Success)
Modified podspec to add parent directory to `HEADER_SEARCH_PATHS`.
- **Result:** Configuration is set but compiler doesn't use it consistently

### ‚ùå 4. **Combined Approach** (Current State)
All three fixes together.
- **Result:** Build progresses further but still fails on Yoga compilation

---

## Why It's So Difficult

1. **CocoaPods Limitations**
   - Header search paths set in podspec aren't always applied
   - `PODS_TARGET_SRCROOT` resolves differently than expected
   - Static libraries vs frameworks behave differently

2. **Xcode Build System**
   - Caches headers aggressively
   - Build settings can be overridden at multiple levels
   - Header maps generated by CocoaPods may not include our custom paths

3. **React Native Architecture**
   - Yoga is deeply integrated into React Native core
   - Can't be easily replaced or bypassed
   - Breaking changes in 0.76.x weren't well documented

---

## Options Going Forward

### Option 1: Downgrade to React Native 0.75.x ‚≠ê RECOMMENDED

**Pros:**
- ‚úÖ Proven stable
- ‚úÖ No Yoga header issues
- ‚úÖ Well-tested with our dependencies
- ‚úÖ Immediate solution

**Cons:**
- ‚ùå Miss out on 0.76.x features
- ‚ùå Will need to upgrade eventually

**How to downgrade:**
```bash
# 1. Update package.json
npm install react-native@0.75.4

# 2. Clean and reinstall
rm -rf node_modules ios/Pods
npm install --legacy-peer-deps
cd ios && pod install && cd ..

# 3. Build (no special fixes needed!)
npx react-native run-ios
```

### Option 2: Wait for React Native 0.77.x

**Pros:**
- ‚úÖ Facebook may fix Yoga issues
- ‚úÖ More mature release
- ‚úÖ Community-tested solutions

**Cons:**
- ‚ùå Unknown timeline
- ‚ùå Can't build iOS now
- ‚ùå May have other breaking changes

### Option 3: Continue Debugging 0.76.x

**Pros:**
- ‚úÖ Eventually understand the issue
- ‚úÖ Stay on latest version

**Cons:**
- ‚ùå Time-consuming
- ‚ùå May not be solvable without React Native core changes
- ‚ùå Blocks iOS development

---

## What We've Learned

### The Real Problem

The issue isn't just header paths - it's that React Native 0.76.x fundamentally changed how Yoga is structured, but didn't update the CocoaPods integration properly. The Yoga.podspec still assumes a flat structure while the actual code uses a nested structure.

### Why Our Fixes Don't Fully Work

1. **Podspec changes** work for some targets but not all
2. **Symbolic links** help but don't solve the root cause
3. **Podfile modifications** are applied after CocoaPods generates the project, limiting their effectiveness

### What Would Be Needed

A complete fix would require:
1. **React Native core change** - Update Yoga.podspec properly
2. **Or** - Revert Yoga directory structure to 0.75.x layout
3. **Or** - Change all Yoga includes to not use the `yoga/` prefix

None of these are things we can do without forking React Native.

---

## Recommendation

**For production app development: Downgrade to React Native 0.75.4**

```bash
npm install react-native@0.75.4 --save
rm -rf node_modules ios/Pods ios/Podfile.lock
npm install --legacy-peer-deps
cd ios && pod install && cd ..
npx react-native run-ios
```

**Benefits:**
- Immediate iOS build success
- No complex workarounds needed
- Proven stable with your current dependencies
- Can upgrade to 0.77.x when it's released and stable

---

## If Staying on 0.76.x

If you must stay on 0.76.x, be aware:
- iOS builds may continue to fail
- Fixes are fragile and may break
- Significant development time lost debugging
- May need to wait for React Native team to fix

Monitor these for updates:
- https://github.com/facebook/react-native/issues (search for "Yoga 0.76")
- React Native releases page
- Community discussions

---

## Files to Keep If Downgrading

Even if you downgrade, keep these files for reference:
- `docs/ios/` - All documentation
- `scripts/fix-yoga-headers.sh` - May be useful in future
- `patches/react-native+0.76.9.patch` - Reference for what we tried

---

**Our assessment: React Native 0.76.x has significant iOS build issues that are not easily resolved. Downgrade to 0.75.x for production use.** üéØ

